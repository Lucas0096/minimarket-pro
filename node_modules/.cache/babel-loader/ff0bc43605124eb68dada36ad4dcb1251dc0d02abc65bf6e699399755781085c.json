{"ast":null,"code":"import _objectSpread from\"C:/Users/lucas/OneDrive/Documentos/Minimarket PRO/Version 1.0/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import ProductForm from'./ProductForm';import ProductList from'./ProductList';import StockAlerts from'./StockAlerts';import{isAdmin,getCurrentMarket,isVendedor,isMarket}from'../utils/auth';import{getAllData,putData,addData,deleteData,syncLocalStorageWithIndexedDB}from'../utils/indexedDb';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProductsDashboard=_ref=>{let{isOnline,selectedMarket}=_ref;const[allProducts,setAllProducts]=useState([]);const[filteredProducts,setFilteredProducts]=useState([]);const[categories,setCategories]=useState([]);const[showForm,setShowForm]=useState(false);const[editingProduct,setEditingProduct]=useState(null);const[searchTerm,setSearchTerm]=useState('');useEffect(()=>{const loadData=async()=>{const savedProducts=await getAllData('products');const marketToShow=isAdmin()?selectedMarket:getCurrentMarket();const productsForMarket=isAdmin()&&selectedMarket?savedProducts.filter(p=>p.marketId===selectedMarket):savedProducts.filter(p=>p.marketId===marketToShow);setAllProducts(productsForMarket);setFilteredProducts(productsForMarket);const savedCategories=JSON.parse(localStorage.getItem('categories'))||['Alimentos','Bebidas','Limpieza','Fiambres'];setCategories(savedCategories);};loadData();},[selectedMarket]);useEffect(()=>{const results=allProducts.filter(product=>product.name.toLowerCase().includes(searchTerm.toLowerCase())||product.barcode&&product.barcode.includes(searchTerm));setFilteredProducts(results);},[searchTerm,allProducts]);const saveProducts=async updatedProducts=>{const marketToShow=isAdmin()?selectedMarket:getCurrentMarket();const currentMarketProducts=updatedProducts.filter(p=>p.marketId===marketToShow);setAllProducts(currentMarketProducts);setFilteredProducts(currentMarketProducts.filter(product=>product.name.toLowerCase().includes(searchTerm.toLowerCase())||product.barcode&&product.barcode.includes(searchTerm)));const allExistingProducts=await getAllData('products');const otherMarketsProducts=allExistingProducts.filter(p=>p.marketId!==marketToShow);const finalProductsToSave=[...otherMarketsProducts,...currentMarketProducts];for(const product of finalProductsToSave){await putData('products',product);}syncLocalStorageWithIndexedDB('products',finalProductsToSave);};const handleAddProduct=async product=>{const marketId=isAdmin()?product.marketId:getCurrentMarket();const productWithMarket=_objectSpread(_objectSpread({},product),{},{marketId});const allExistingProducts=await getAllData('products');const newProducts=[...allExistingProducts,productWithMarket];await addData('products',productWithMarket);saveProducts(newProducts);setShowForm(false);};const handleUpdateProduct=async updatedProduct=>{const allExistingProducts=await getAllData('products');const newProducts=allExistingProducts.map(p=>p.id===updatedProduct.id?updatedProduct:p);await putData('products',updatedProduct);saveProducts(newProducts);setEditingProduct(null);setShowForm(false);};const handleDeleteProduct=async id=>{await deleteData('products',id);const allExistingProducts=await getAllData('products');saveProducts(allExistingProducts);};const handleEditProduct=product=>{setEditingProduct(product);setShowForm(true);};if(!isAdmin()&&!isMarket()){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-10 text-gray-800 dark:text-white\",children:\"Acceso no autorizado\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-md dark:bg-gray-800\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 dark:text-white mb-6\",children:\"Gesti\\xF3n de Productos\"}),(isAdmin()||isMarket())&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setEditingProduct(null);setShowForm(true);},className:\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors\",children:\"Agregar Producto\"}),/*#__PURE__*/_jsx(StockAlerts,{products:filteredProducts}),showForm&&/*#__PURE__*/_jsx(ProductForm,{categories:categories,product:editingProduct,onAddProduct:handleAddProduct,onUpdateProduct:handleUpdateProduct,onCancel:()=>setShowForm(false)}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),placeholder:\"Buscar productos por nombre o c\\xF3digo de barras...\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"})}),/*#__PURE__*/_jsx(ProductList,{products:filteredProducts,onEdit:handleEditProduct,onDelete:handleDeleteProduct})]});};export default ProductsDashboard;","map":{"version":3,"names":["React","useState","useEffect","ProductForm","ProductList","StockAlerts","isAdmin","getCurrentMarket","isVendedor","isMarket","getAllData","putData","addData","deleteData","syncLocalStorageWithIndexedDB","jsx","_jsx","jsxs","_jsxs","ProductsDashboard","_ref","isOnline","selectedMarket","allProducts","setAllProducts","filteredProducts","setFilteredProducts","categories","setCategories","showForm","setShowForm","editingProduct","setEditingProduct","searchTerm","setSearchTerm","loadData","savedProducts","marketToShow","productsForMarket","filter","p","marketId","savedCategories","JSON","parse","localStorage","getItem","results","product","name","toLowerCase","includes","barcode","saveProducts","updatedProducts","currentMarketProducts","allExistingProducts","otherMarketsProducts","finalProductsToSave","handleAddProduct","productWithMarket","_objectSpread","newProducts","handleUpdateProduct","updatedProduct","map","id","handleDeleteProduct","handleEditProduct","className","children","onClick","products","onAddProduct","onUpdateProduct","onCancel","type","value","onChange","e","target","placeholder","onEdit","onDelete"],"sources":["C:/Users/lucas/OneDrive/Documentos/Minimarket PRO/Version 1.0/src/components/ProductsDashboard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport ProductForm from './ProductForm';\nimport ProductList from './ProductList';\nimport StockAlerts from './StockAlerts';\nimport { isAdmin, getCurrentMarket, isVendedor, isMarket } from '../utils/auth';\nimport { getAllData, putData, addData, deleteData, syncLocalStorageWithIndexedDB } from '../utils/indexedDb';\n\nconst ProductsDashboard = ({ isOnline, selectedMarket }) => {\n  const [allProducts, setAllProducts] = useState([]);\n  const [filteredProducts, setFilteredProducts] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [showForm, setShowForm] = useState(false);\n  const [editingProduct, setEditingProduct] = useState(null);\n  const [searchTerm, setSearchTerm] = useState('');\n\n  useEffect(() => {\n    const loadData = async () => {\n      const savedProducts = await getAllData('products');\n      const marketToShow = isAdmin() ? selectedMarket : getCurrentMarket();\n      const productsForMarket = isAdmin() && selectedMarket ? \n        savedProducts.filter(p => p.marketId === selectedMarket) : \n        savedProducts.filter(p => p.marketId === marketToShow);\n      \n      setAllProducts(productsForMarket);\n      setFilteredProducts(productsForMarket);\n      \n      const savedCategories = JSON.parse(localStorage.getItem('categories')) || ['Alimentos', 'Bebidas', 'Limpieza', 'Fiambres'];\n      setCategories(savedCategories);\n    };\n    loadData();\n  }, [selectedMarket]);\n\n  useEffect(() => {\n    const results = allProducts.filter(product =>\n      product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (product.barcode && product.barcode.includes(searchTerm))\n    );\n    setFilteredProducts(results);\n  }, [searchTerm, allProducts]);\n\n  const saveProducts = async (updatedProducts) => {\n    const marketToShow = isAdmin() ? selectedMarket : getCurrentMarket();\n    const currentMarketProducts = updatedProducts.filter(p => p.marketId === marketToShow);\n    setAllProducts(currentMarketProducts);\n    setFilteredProducts(currentMarketProducts.filter(product =>\n      product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      (product.barcode && product.barcode.includes(searchTerm))\n    ));\n\n    const allExistingProducts = await getAllData('products');\n    const otherMarketsProducts = allExistingProducts.filter(p => p.marketId !== marketToShow);\n    const finalProductsToSave = [...otherMarketsProducts, ...currentMarketProducts];\n    \n    for (const product of finalProductsToSave) {\n      await putData('products', product);\n    }\n    syncLocalStorageWithIndexedDB('products', finalProductsToSave);\n  };\n\n  const handleAddProduct = async (product) => {\n    const marketId = isAdmin() ? product.marketId : getCurrentMarket();\n    const productWithMarket = { ...product, marketId };\n    const allExistingProducts = await getAllData('products');\n    const newProducts = [...allExistingProducts, productWithMarket];\n    await addData('products', productWithMarket);\n    saveProducts(newProducts);\n    setShowForm(false);\n  };\n\n  const handleUpdateProduct = async (updatedProduct) => {\n    const allExistingProducts = await getAllData('products');\n    const newProducts = allExistingProducts.map(p => \n      p.id === updatedProduct.id ? updatedProduct : p\n    );\n    await putData('products', updatedProduct);\n    saveProducts(newProducts);\n    setEditingProduct(null);\n    setShowForm(false);\n  };\n\n  const handleDeleteProduct = async (id) => {\n    await deleteData('products', id);\n    const allExistingProducts = await getAllData('products');\n    saveProducts(allExistingProducts);\n  };\n\n  const handleEditProduct = (product) => {\n    setEditingProduct(product);\n    setShowForm(true);\n  };\n\n  if (!isAdmin() && !isMarket()) {\n    return <div className=\"text-center py-10 text-gray-800 dark:text-white\">Acceso no autorizado</div>;\n  }\n\n  return (\n    <div className=\"bg-white p-6 rounded-lg shadow-md dark:bg-gray-800\">\n      <h2 className=\"text-2xl font-bold text-gray-800 dark:text-white mb-6\">Gestión de Productos</h2>\n      {(isAdmin() || isMarket()) && (\n        <button\n          onClick={() => {\n            setEditingProduct(null);\n            setShowForm(true);\n          }}\n          className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors\"\n        >\n          Agregar Producto\n        </button>\n      )}\n\n      <StockAlerts products={filteredProducts} />\n\n      {showForm && (\n        <ProductForm\n          categories={categories}\n          product={editingProduct}\n          onAddProduct={handleAddProduct}\n          onUpdateProduct={handleUpdateProduct}\n          onCancel={() => setShowForm(false)}\n        />\n      )}\n\n      <div className=\"mb-4\">\n        <input\n          type=\"text\"\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          placeholder=\"Buscar productos por nombre o código de barras...\"\n          className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n        />\n      </div>\n\n      <ProductList\n        products={filteredProducts}\n        onEdit={handleEditProduct}\n        onDelete={handleDeleteProduct}\n      />\n    </div>\n  );\n};\n\nexport default ProductsDashboard;"],"mappings":"kJAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,WAAW,KAAM,eAAe,CACvC,MAAO,CAAAC,WAAW,KAAM,eAAe,CACvC,MAAO,CAAAC,WAAW,KAAM,eAAe,CACvC,OAASC,OAAO,CAAEC,gBAAgB,CAAEC,UAAU,CAAEC,QAAQ,KAAQ,eAAe,CAC/E,OAASC,UAAU,CAAEC,OAAO,CAAEC,OAAO,CAAEC,UAAU,CAAEC,6BAA6B,KAAQ,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE7G,KAAM,CAAAC,iBAAiB,CAAGC,IAAA,EAAkC,IAAjC,CAAEC,QAAQ,CAAEC,cAAe,CAAC,CAAAF,IAAA,CACrD,KAAM,CAACG,WAAW,CAAEC,cAAc,CAAC,CAAGvB,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAACwB,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGzB,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAAC0B,UAAU,CAAEC,aAAa,CAAC,CAAG3B,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC4B,QAAQ,CAAEC,WAAW,CAAC,CAAG7B,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAAC8B,cAAc,CAAEC,iBAAiB,CAAC,CAAG/B,QAAQ,CAAC,IAAI,CAAC,CAC1D,KAAM,CAACgC,UAAU,CAAEC,aAAa,CAAC,CAAGjC,QAAQ,CAAC,EAAE,CAAC,CAEhDC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAiC,QAAQ,CAAG,KAAAA,CAAA,GAAY,CAC3B,KAAM,CAAAC,aAAa,CAAG,KAAM,CAAA1B,UAAU,CAAC,UAAU,CAAC,CAClD,KAAM,CAAA2B,YAAY,CAAG/B,OAAO,CAAC,CAAC,CAAGgB,cAAc,CAAGf,gBAAgB,CAAC,CAAC,CACpE,KAAM,CAAA+B,iBAAiB,CAAGhC,OAAO,CAAC,CAAC,EAAIgB,cAAc,CACnDc,aAAa,CAACG,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,QAAQ,GAAKnB,cAAc,CAAC,CACxDc,aAAa,CAACG,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,QAAQ,GAAKJ,YAAY,CAAC,CAExDb,cAAc,CAACc,iBAAiB,CAAC,CACjCZ,mBAAmB,CAACY,iBAAiB,CAAC,CAEtC,KAAM,CAAAI,eAAe,CAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC,EAAI,CAAC,WAAW,CAAE,SAAS,CAAE,UAAU,CAAE,UAAU,CAAC,CAC1HlB,aAAa,CAACc,eAAe,CAAC,CAChC,CAAC,CACDP,QAAQ,CAAC,CAAC,CACZ,CAAC,CAAE,CAACb,cAAc,CAAC,CAAC,CAEpBpB,SAAS,CAAC,IAAM,CACd,KAAM,CAAA6C,OAAO,CAAGxB,WAAW,CAACgB,MAAM,CAACS,OAAO,EACxCA,OAAO,CAACC,IAAI,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAClB,UAAU,CAACiB,WAAW,CAAC,CAAC,CAAC,EAC5DF,OAAO,CAACI,OAAO,EAAIJ,OAAO,CAACI,OAAO,CAACD,QAAQ,CAAClB,UAAU,CACzD,CAAC,CACDP,mBAAmB,CAACqB,OAAO,CAAC,CAC9B,CAAC,CAAE,CAACd,UAAU,CAAEV,WAAW,CAAC,CAAC,CAE7B,KAAM,CAAA8B,YAAY,CAAG,KAAO,CAAAC,eAAe,EAAK,CAC9C,KAAM,CAAAjB,YAAY,CAAG/B,OAAO,CAAC,CAAC,CAAGgB,cAAc,CAAGf,gBAAgB,CAAC,CAAC,CACpE,KAAM,CAAAgD,qBAAqB,CAAGD,eAAe,CAACf,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,QAAQ,GAAKJ,YAAY,CAAC,CACtFb,cAAc,CAAC+B,qBAAqB,CAAC,CACrC7B,mBAAmB,CAAC6B,qBAAqB,CAAChB,MAAM,CAACS,OAAO,EACtDA,OAAO,CAACC,IAAI,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAClB,UAAU,CAACiB,WAAW,CAAC,CAAC,CAAC,EAC5DF,OAAO,CAACI,OAAO,EAAIJ,OAAO,CAACI,OAAO,CAACD,QAAQ,CAAClB,UAAU,CACzD,CAAC,CAAC,CAEF,KAAM,CAAAuB,mBAAmB,CAAG,KAAM,CAAA9C,UAAU,CAAC,UAAU,CAAC,CACxD,KAAM,CAAA+C,oBAAoB,CAAGD,mBAAmB,CAACjB,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,QAAQ,GAAKJ,YAAY,CAAC,CACzF,KAAM,CAAAqB,mBAAmB,CAAG,CAAC,GAAGD,oBAAoB,CAAE,GAAGF,qBAAqB,CAAC,CAE/E,IAAK,KAAM,CAAAP,OAAO,GAAI,CAAAU,mBAAmB,CAAE,CACzC,KAAM,CAAA/C,OAAO,CAAC,UAAU,CAAEqC,OAAO,CAAC,CACpC,CACAlC,6BAA6B,CAAC,UAAU,CAAE4C,mBAAmB,CAAC,CAChE,CAAC,CAED,KAAM,CAAAC,gBAAgB,CAAG,KAAO,CAAAX,OAAO,EAAK,CAC1C,KAAM,CAAAP,QAAQ,CAAGnC,OAAO,CAAC,CAAC,CAAG0C,OAAO,CAACP,QAAQ,CAAGlC,gBAAgB,CAAC,CAAC,CAClE,KAAM,CAAAqD,iBAAiB,CAAAC,aAAA,CAAAA,aAAA,IAAQb,OAAO,MAAEP,QAAQ,EAAE,CAClD,KAAM,CAAAe,mBAAmB,CAAG,KAAM,CAAA9C,UAAU,CAAC,UAAU,CAAC,CACxD,KAAM,CAAAoD,WAAW,CAAG,CAAC,GAAGN,mBAAmB,CAAEI,iBAAiB,CAAC,CAC/D,KAAM,CAAAhD,OAAO,CAAC,UAAU,CAAEgD,iBAAiB,CAAC,CAC5CP,YAAY,CAACS,WAAW,CAAC,CACzBhC,WAAW,CAAC,KAAK,CAAC,CACpB,CAAC,CAED,KAAM,CAAAiC,mBAAmB,CAAG,KAAO,CAAAC,cAAc,EAAK,CACpD,KAAM,CAAAR,mBAAmB,CAAG,KAAM,CAAA9C,UAAU,CAAC,UAAU,CAAC,CACxD,KAAM,CAAAoD,WAAW,CAAGN,mBAAmB,CAACS,GAAG,CAACzB,CAAC,EAC3CA,CAAC,CAAC0B,EAAE,GAAKF,cAAc,CAACE,EAAE,CAAGF,cAAc,CAAGxB,CAChD,CAAC,CACD,KAAM,CAAA7B,OAAO,CAAC,UAAU,CAAEqD,cAAc,CAAC,CACzCX,YAAY,CAACS,WAAW,CAAC,CACzB9B,iBAAiB,CAAC,IAAI,CAAC,CACvBF,WAAW,CAAC,KAAK,CAAC,CACpB,CAAC,CAED,KAAM,CAAAqC,mBAAmB,CAAG,KAAO,CAAAD,EAAE,EAAK,CACxC,KAAM,CAAArD,UAAU,CAAC,UAAU,CAAEqD,EAAE,CAAC,CAChC,KAAM,CAAAV,mBAAmB,CAAG,KAAM,CAAA9C,UAAU,CAAC,UAAU,CAAC,CACxD2C,YAAY,CAACG,mBAAmB,CAAC,CACnC,CAAC,CAED,KAAM,CAAAY,iBAAiB,CAAIpB,OAAO,EAAK,CACrChB,iBAAiB,CAACgB,OAAO,CAAC,CAC1BlB,WAAW,CAAC,IAAI,CAAC,CACnB,CAAC,CAED,GAAI,CAACxB,OAAO,CAAC,CAAC,EAAI,CAACG,QAAQ,CAAC,CAAC,CAAE,CAC7B,mBAAOO,IAAA,QAAKqD,SAAS,CAAC,iDAAiD,CAAAC,QAAA,CAAC,sBAAoB,CAAK,CAAC,CACpG,CAEA,mBACEpD,KAAA,QAAKmD,SAAS,CAAC,oDAAoD,CAAAC,QAAA,eACjEtD,IAAA,OAAIqD,SAAS,CAAC,uDAAuD,CAAAC,QAAA,CAAC,yBAAoB,CAAI,CAAC,CAC9F,CAAChE,OAAO,CAAC,CAAC,EAAIG,QAAQ,CAAC,CAAC,gBACvBO,IAAA,WACEuD,OAAO,CAAEA,CAAA,GAAM,CACbvC,iBAAiB,CAAC,IAAI,CAAC,CACvBF,WAAW,CAAC,IAAI,CAAC,CACnB,CAAE,CACFuC,SAAS,CAAC,iFAAiF,CAAAC,QAAA,CAC5F,kBAED,CAAQ,CACT,cAEDtD,IAAA,CAACX,WAAW,EAACmE,QAAQ,CAAE/C,gBAAiB,CAAE,CAAC,CAE1CI,QAAQ,eACPb,IAAA,CAACb,WAAW,EACVwB,UAAU,CAAEA,UAAW,CACvBqB,OAAO,CAAEjB,cAAe,CACxB0C,YAAY,CAAEd,gBAAiB,CAC/Be,eAAe,CAAEX,mBAAoB,CACrCY,QAAQ,CAAEA,CAAA,GAAM7C,WAAW,CAAC,KAAK,CAAE,CACpC,CACF,cAEDd,IAAA,QAAKqD,SAAS,CAAC,MAAM,CAAAC,QAAA,cACnBtD,IAAA,UACE4D,IAAI,CAAC,MAAM,CACXC,KAAK,CAAE5C,UAAW,CAClB6C,QAAQ,CAAGC,CAAC,EAAK7C,aAAa,CAAC6C,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC/CI,WAAW,CAAC,sDAAmD,CAC/DZ,SAAS,CAAC,iLAAiL,CAC5L,CAAC,CACC,CAAC,cAENrD,IAAA,CAACZ,WAAW,EACVoE,QAAQ,CAAE/C,gBAAiB,CAC3ByD,MAAM,CAAEd,iBAAkB,CAC1Be,QAAQ,CAAEhB,mBAAoB,CAC/B,CAAC,EACC,CAAC,CAEV,CAAC,CAED,cAAe,CAAAhD,iBAAiB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}