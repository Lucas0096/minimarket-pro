{"ast":null,"code":"import React,{useState}from'react';import{getAllData,clearStore,putData,addData,STORES}from'../utils/indexedDb';import{getCurrentUser}from'../utils/auth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BackupRestoreDashboard=()=>{const[message,setMessage]=useState({type:'',text:''});const currentUser=getCurrentUser();const handleExportData=async()=>{try{const backupData={};for(const storeName of STORES){if(!currentUser||currentUser.role!=='admin'){if(storeName.startsWith('cashMovements_')||storeName.startsWith('cashRegisterState_')){if(!storeName.includes(currentUser.username)){continue;}}}backupData[storeName]=await getAllData(storeName);}const dataStr=JSON.stringify(backupData,null,2);const blob=new Blob([dataStr],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"minimarket_backup_\".concat(new Date().toISOString().slice(0,10),\".json\");document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);setMessage({type:'success',text:'Backup exportado con éxito.'});}catch(error){console.error('Error exporting data:',error);setMessage({type:'error',text:\"Error al exportar backup: \".concat(error.message)});}};const handleImportData=async event=>{const file=event.target.files[0];if(!file){return;}const reader=new FileReader();reader.onload=async e=>{try{const importedData=JSON.parse(e.target.result);if(!window.confirm('¿Estás seguro de que quieres importar este backup? Esto sobrescribirá los datos actuales.')){return;}for(const storeName of STORES){if(importedData[storeName]){await clearStore(storeName);for(const item of importedData[storeName]){await putData(storeName,item);}}}setMessage({type:'success',text:'Backup importado con éxito. Recarga la página para ver los cambios.'});}catch(error){console.error('Error importing data:',error);setMessage({type:'error',text:\"Error al importar backup: \".concat(error.message)});}};reader.readAsText(file);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-md dark:bg-gray-800\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 dark:text-white mb-6\",children:\"Backup y Restauraci\\xF3n\"}),message.text&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 mb-4 rounded-md \".concat(message.type==='success'?'bg-green-100 text-green-800':'bg-red-100 text-red-800'),children:message.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-4 rounded-lg shadow-inner dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-800 dark:text-white mb-4\",children:\"Exportar Datos\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 dark:text-gray-300 mb-4\",children:\"Descarga una copia de seguridad de todos tus datos en formato JSON. Este archivo puede ser usado para restaurar tu informaci\\xF3n en el futuro.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleExportData,className:\"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors\",children:\"Descargar Backup (JSON)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-4 rounded-lg shadow-inner dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-800 dark:text-white mb-4\",children:\"Importar Backup\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 dark:text-gray-300 mb-4\",children:\"Sube un archivo JSON de backup para restaurar tus datos. \\xA1Atenci\\xF3n! Esto sobrescribir\\xE1 los datos existentes.\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".json\",onChange:handleImportData,className:\"w-full text-sm text-gray-500 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-lg dark:bg-yellow-800 dark:border-yellow-600 dark:text-yellow-100\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold\",children:\"Nota sobre Backups Autom\\xE1ticos:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"La funcionalidad de \\\"Backup diario autom\\xE1tico en NAS o almacenamiento externo\\\" requiere una integraci\\xF3n con un sistema de servidor o un servicio en la nube (como AWS S3, Google Cloud Storage, etc.) y no puede ser implementada directamente desde una aplicaci\\xF3n web de frontend puro. Esto implicar\\xEDa un backend que gestione la conexi\\xF3n con el NAS/almacenamiento y la programaci\\xF3n de las tareas de backup.\"})]})]});};export default BackupRestoreDashboard;","map":{"version":3,"names":["React","useState","getAllData","clearStore","putData","addData","STORES","getCurrentUser","jsx","_jsx","jsxs","_jsxs","BackupRestoreDashboard","message","setMessage","type","text","currentUser","handleExportData","backupData","storeName","role","startsWith","includes","username","dataStr","JSON","stringify","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","concat","Date","toISOString","slice","body","appendChild","click","removeChild","revokeObjectURL","error","console","handleImportData","event","file","target","files","reader","FileReader","onload","e","importedData","parse","result","window","confirm","item","readAsText","className","children","onClick","accept","onChange"],"sources":["C:/Users/lucas/Downloads/Minimarket PRO/src/components/BackupRestoreDashboard.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { getAllData, clearStore, putData, addData, STORES } from '../utils/indexedDb';\r\nimport { getCurrentUser } from '../utils/auth';\r\n\r\nconst BackupRestoreDashboard = () => {\r\n  const [message, setMessage] = useState({ type: '', text: '' });\r\n  const currentUser = getCurrentUser();\r\n\r\n  const handleExportData = async () => {\r\n    try {\r\n      const backupData = {};\r\n      for (const storeName of STORES) {\r\n        if (!currentUser || currentUser.role !== 'admin') {\r\n          if (storeName.startsWith('cashMovements_') || storeName.startsWith('cashRegisterState_')) {\r\n            if (!storeName.includes(currentUser.username)) {\r\n              continue;\r\n            }\r\n          }\r\n        }\r\n        backupData[storeName] = await getAllData(storeName);\r\n      }\r\n      \r\n      const dataStr = JSON.stringify(backupData, null, 2);\r\n      const blob = new Blob([dataStr], { type: 'application/json' });\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `minimarket_backup_${new Date().toISOString().slice(0, 10)}.json`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n      setMessage({ type: 'success', text: 'Backup exportado con éxito.' });\r\n    } catch (error) {\r\n      console.error('Error exporting data:', error);\r\n      setMessage({ type: 'error', text: `Error al exportar backup: ${error.message}` });\r\n    }\r\n  };\r\n\r\n  const handleImportData = async (event) => {\r\n    const file = event.target.files[0];\r\n    if (!file) {\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = async (e) => {\r\n      try {\r\n        const importedData = JSON.parse(e.target.result);\r\n        \r\n        if (!window.confirm('¿Estás seguro de que quieres importar este backup? Esto sobrescribirá los datos actuales.')) {\r\n          return;\r\n        }\r\n\r\n        for (const storeName of STORES) {\r\n          if (importedData[storeName]) {\r\n            await clearStore(storeName);\r\n            for (const item of importedData[storeName]) {\r\n              await putData(storeName, item); \r\n            }\r\n          }\r\n        }\r\n        setMessage({ type: 'success', text: 'Backup importado con éxito. Recarga la página para ver los cambios.' });\r\n      } catch (error) {\r\n        console.error('Error importing data:', error);\r\n        setMessage({ type: 'error', text: `Error al importar backup: ${error.message}` });\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white p-6 rounded-lg shadow-md dark:bg-gray-800\">\r\n      <h2 className=\"text-2xl font-bold text-gray-800 dark:text-white mb-6\">Backup y Restauración</h2>\r\n\r\n      {message.text && (\r\n        <div className={`p-3 mb-4 rounded-md ${message.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\r\n          {message.text}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        <div className=\"bg-gray-50 p-4 rounded-lg shadow-inner dark:bg-gray-700\">\r\n          <h3 className=\"text-lg font-medium text-gray-800 dark:text-white mb-4\">Exportar Datos</h3>\r\n          <p className=\"text-gray-700 dark:text-gray-300 mb-4\">\r\n            Descarga una copia de seguridad de todos tus datos en formato JSON.\r\n            Este archivo puede ser usado para restaurar tu información en el futuro.\r\n          </p>\r\n          <button\r\n            onClick={handleExportData}\r\n            className=\"w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors\"\r\n          >\r\n            Descargar Backup (JSON)\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"bg-gray-50 p-4 rounded-lg shadow-inner dark:bg-gray-700\">\r\n          <h3 className=\"text-lg font-medium text-gray-800 dark:text-white mb-4\">Importar Backup</h3>\r\n          <p className=\"text-gray-700 dark:text-gray-300 mb-4\">\r\n            Sube un archivo JSON de backup para restaurar tus datos.\r\n            ¡Atención! Esto sobrescribirá los datos existentes.\r\n          </p>\r\n          <input\r\n            type=\"file\"\r\n            accept=\".json\"\r\n            onChange={handleImportData}\r\n            className=\"w-full text-sm text-gray-500 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mt-8 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-lg dark:bg-yellow-800 dark:border-yellow-600 dark:text-yellow-100\">\r\n        <p className=\"font-bold\">Nota sobre Backups Automáticos:</p>\r\n        <p className=\"text-sm\">\r\n          La funcionalidad de \"Backup diario automático en NAS o almacenamiento externo\"\r\n          requiere una integración con un sistema de servidor o un servicio en la nube\r\n          (como AWS S3, Google Cloud Storage, etc.) y no puede ser implementada\r\n          directamente desde una aplicación web de frontend puro.\r\n          Esto implicaría un backend que gestione la conexión con el NAS/almacenamiento\r\n          y la programación de las tareas de backup.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BackupRestoreDashboard;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,KAAQ,OAAO,CACvC,OAASC,UAAU,CAAEC,UAAU,CAAEC,OAAO,CAAEC,OAAO,CAAEC,MAAM,KAAQ,oBAAoB,CACrF,OAASC,cAAc,KAAQ,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE/C,KAAM,CAAAC,sBAAsB,CAAGA,CAAA,GAAM,CACnC,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGb,QAAQ,CAAC,CAAEc,IAAI,CAAE,EAAE,CAAEC,IAAI,CAAE,EAAG,CAAC,CAAC,CAC9D,KAAM,CAAAC,WAAW,CAAGV,cAAc,CAAC,CAAC,CAEpC,KAAM,CAAAW,gBAAgB,CAAG,KAAAA,CAAA,GAAY,CACnC,GAAI,CACF,KAAM,CAAAC,UAAU,CAAG,CAAC,CAAC,CACrB,IAAK,KAAM,CAAAC,SAAS,GAAI,CAAAd,MAAM,CAAE,CAC9B,GAAI,CAACW,WAAW,EAAIA,WAAW,CAACI,IAAI,GAAK,OAAO,CAAE,CAChD,GAAID,SAAS,CAACE,UAAU,CAAC,gBAAgB,CAAC,EAAIF,SAAS,CAACE,UAAU,CAAC,oBAAoB,CAAC,CAAE,CACxF,GAAI,CAACF,SAAS,CAACG,QAAQ,CAACN,WAAW,CAACO,QAAQ,CAAC,CAAE,CAC7C,SACF,CACF,CACF,CACAL,UAAU,CAACC,SAAS,CAAC,CAAG,KAAM,CAAAlB,UAAU,CAACkB,SAAS,CAAC,CACrD,CAEA,KAAM,CAAAK,OAAO,CAAGC,IAAI,CAACC,SAAS,CAACR,UAAU,CAAE,IAAI,CAAE,CAAC,CAAC,CACnD,KAAM,CAAAS,IAAI,CAAG,GAAI,CAAAC,IAAI,CAAC,CAACJ,OAAO,CAAC,CAAE,CAAEV,IAAI,CAAE,kBAAmB,CAAC,CAAC,CAC9D,KAAM,CAAAe,GAAG,CAAGC,GAAG,CAACC,eAAe,CAACJ,IAAI,CAAC,CACrC,KAAM,CAAAK,CAAC,CAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC,CACrCF,CAAC,CAACG,IAAI,CAAGN,GAAG,CACZG,CAAC,CAACI,QAAQ,sBAAAC,MAAA,CAAwB,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC,CAAE,EAAE,CAAC,SAAO,CAC9EP,QAAQ,CAACQ,IAAI,CAACC,WAAW,CAACV,CAAC,CAAC,CAC5BA,CAAC,CAACW,KAAK,CAAC,CAAC,CACTV,QAAQ,CAACQ,IAAI,CAACG,WAAW,CAACZ,CAAC,CAAC,CAC5BF,GAAG,CAACe,eAAe,CAAChB,GAAG,CAAC,CACxBhB,UAAU,CAAC,CAAEC,IAAI,CAAE,SAAS,CAAEC,IAAI,CAAE,6BAA8B,CAAC,CAAC,CACtE,CAAE,MAAO+B,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC7CjC,UAAU,CAAC,CAAEC,IAAI,CAAE,OAAO,CAAEC,IAAI,8BAAAsB,MAAA,CAA+BS,KAAK,CAAClC,OAAO,CAAG,CAAC,CAAC,CACnF,CACF,CAAC,CAED,KAAM,CAAAoC,gBAAgB,CAAG,KAAO,CAAAC,KAAK,EAAK,CACxC,KAAM,CAAAC,IAAI,CAAGD,KAAK,CAACE,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAClC,GAAI,CAACF,IAAI,CAAE,CACT,OACF,CAEA,KAAM,CAAAG,MAAM,CAAG,GAAI,CAAAC,UAAU,CAAC,CAAC,CAC/BD,MAAM,CAACE,MAAM,CAAG,KAAO,CAAAC,CAAC,EAAK,CAC3B,GAAI,CACF,KAAM,CAAAC,YAAY,CAAGhC,IAAI,CAACiC,KAAK,CAACF,CAAC,CAACL,MAAM,CAACQ,MAAM,CAAC,CAEhD,GAAI,CAACC,MAAM,CAACC,OAAO,CAAC,2FAA2F,CAAC,CAAE,CAChH,OACF,CAEA,IAAK,KAAM,CAAA1C,SAAS,GAAI,CAAAd,MAAM,CAAE,CAC9B,GAAIoD,YAAY,CAACtC,SAAS,CAAC,CAAE,CAC3B,KAAM,CAAAjB,UAAU,CAACiB,SAAS,CAAC,CAC3B,IAAK,KAAM,CAAA2C,IAAI,GAAI,CAAAL,YAAY,CAACtC,SAAS,CAAC,CAAE,CAC1C,KAAM,CAAAhB,OAAO,CAACgB,SAAS,CAAE2C,IAAI,CAAC,CAChC,CACF,CACF,CACAjD,UAAU,CAAC,CAAEC,IAAI,CAAE,SAAS,CAAEC,IAAI,CAAE,qEAAsE,CAAC,CAAC,CAC9G,CAAE,MAAO+B,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC7CjC,UAAU,CAAC,CAAEC,IAAI,CAAE,OAAO,CAAEC,IAAI,8BAAAsB,MAAA,CAA+BS,KAAK,CAAClC,OAAO,CAAG,CAAC,CAAC,CACnF,CACF,CAAC,CACDyC,MAAM,CAACU,UAAU,CAACb,IAAI,CAAC,CACzB,CAAC,CAED,mBACExC,KAAA,QAAKsD,SAAS,CAAC,oDAAoD,CAAAC,QAAA,eACjEzD,IAAA,OAAIwD,SAAS,CAAC,uDAAuD,CAAAC,QAAA,CAAC,0BAAqB,CAAI,CAAC,CAE/FrD,OAAO,CAACG,IAAI,eACXP,IAAA,QAAKwD,SAAS,wBAAA3B,MAAA,CAAyBzB,OAAO,CAACE,IAAI,GAAK,SAAS,CAAG,6BAA6B,CAAG,yBAAyB,CAAG,CAAAmD,QAAA,CAC7HrD,OAAO,CAACG,IAAI,CACV,CACN,cAEDL,KAAA,QAAKsD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,eACpDvD,KAAA,QAAKsD,SAAS,CAAC,yDAAyD,CAAAC,QAAA,eACtEzD,IAAA,OAAIwD,SAAS,CAAC,wDAAwD,CAAAC,QAAA,CAAC,gBAAc,CAAI,CAAC,cAC1FzD,IAAA,MAAGwD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,iJAGrD,CAAG,CAAC,cACJzD,IAAA,WACE0D,OAAO,CAAEjD,gBAAiB,CAC1B+C,SAAS,CAAC,wFAAwF,CAAAC,QAAA,CACnG,yBAED,CAAQ,CAAC,EACN,CAAC,cAENvD,KAAA,QAAKsD,SAAS,CAAC,yDAAyD,CAAAC,QAAA,eACtEzD,IAAA,OAAIwD,SAAS,CAAC,wDAAwD,CAAAC,QAAA,CAAC,iBAAe,CAAI,CAAC,cAC3FzD,IAAA,MAAGwD,SAAS,CAAC,uCAAuC,CAAAC,QAAA,CAAC,uHAGrD,CAAG,CAAC,cACJzD,IAAA,UACEM,IAAI,CAAC,MAAM,CACXqD,MAAM,CAAC,OAAO,CACdC,QAAQ,CAAEpB,gBAAiB,CAC3BgB,SAAS,CAAC,yMAAyM,CACpN,CAAC,EACC,CAAC,EACH,CAAC,cAENtD,KAAA,QAAKsD,SAAS,CAAC,8IAA8I,CAAAC,QAAA,eAC3JzD,IAAA,MAAGwD,SAAS,CAAC,WAAW,CAAAC,QAAA,CAAC,oCAA+B,CAAG,CAAC,cAC5DzD,IAAA,MAAGwD,SAAS,CAAC,SAAS,CAAAC,QAAA,CAAC,waAOvB,CAAG,CAAC,EACD,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAtD,sBAAsB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}