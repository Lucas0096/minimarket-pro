{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{getCurrentMarket}from'../utils/auth';import CustomerSearchModal from'./CustomerSearchModal';import{getAllData}from'../utils/indexedDb';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SaleForm=_ref=>{let{products,onAddSale,onCancel}=_ref;const[saleItems,setSaleItems]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[searchResults,setSearchResults]=useState([]);const[selectedProduct,setSelectedProduct]=useState(null);const[quantity,setQuantity]=useState(1);// Cantidad para productos por unidad\nconst[customerName,setCustomerName]=useState('');const[paymentMethod,setPaymentMethod]=useState('cash');const[invoiceType,setInvoiceType]=useState('ticket');const[cashReceived,setCashReceived]=useState(0);const[showCustomerSearchModal,setShowCustomerSearchModal]=useState(false);const[currentAccountCustomer,setCurrentAccountCustomer]=useState(null);const[allCustomers,setAllCustomers]=useState([]);const[message,setMessage]=useState({type:'',text:''});const barcodeScannerRef=useRef(null);const[weightInput,setWeightInput]=useState(0);// Peso en kilogramos (ej. 0.250)\nconst weightInputRef=useRef(null);useEffect(()=>{const loadCustomers=async()=>{const savedCustomers=await getAllData('customers');const marketId=getCurrentMarket();const customersForMarket=savedCustomers.filter(c=>c.marketId===marketId);setAllCustomers(customersForMarket);};loadCustomers();},[]);useEffect(()=>{if(searchTerm.length>1){const results=products.filter(product=>(product.name.toLowerCase().includes(searchTerm.toLowerCase())||product.barcode&&product.barcode.includes(searchTerm))&&product.stock>0&&!saleItems.some(item=>item.productId===product.id));setSearchResults(results);}else{setSearchResults([]);}},[searchTerm,products,saleItems]);const handleBarcodeScan=e=>{if(e.key==='Enter'){const scannedBarcode=e.target.value;const foundProduct=products.find(p=>p.barcode===scannedBarcode);if(foundProduct){setSelectedProduct(foundProduct);setSearchTerm(foundProduct.name);setQuantity(1);setWeightInput(0);setSearchResults([]);barcodeScannerRef.current.value='';if(foundProduct.unit==='gramos'&&weightInputRef.current){weightInputRef.current.focus();}}else{setMessage({type:'error',text:\"Producto con c\\xF3digo \".concat(scannedBarcode,\" no encontrado.\")});}}};const handleAddItem=()=>{if(!selectedProduct){setMessage({type:'error',text:'Debe seleccionar un producto.'});return;}let itemQuantity=quantity;let itemPrice=selectedProduct.price;// Precio por unidad o por KG\nlet itemSubtotal=selectedProduct.price*quantity;let displayUnit=selectedProduct.unit;if(selectedProduct.unit==='gramos'){if(weightInput<=0){setMessage({type:'error',text:'Debe ingresar un peso válido para productos por gramo.'});return;}itemQuantity=weightInput;// La cantidad es el peso en gramos\nitemPrice=selectedProduct.price;// Precio por KG\nitemSubtotal=selectedProduct.price/1000*weightInput;// Subtotal basado en peso\ndisplayUnit='kg';// Mostrar en kg en el carrito\n}else{if(quantity<=0){setMessage({type:'error',text:'Debe ingresar una cantidad válida.'});return;}if(quantity>selectedProduct.stock){setMessage({type:'error',text:\"No hay suficiente stock para \".concat(selectedProduct.name,\". Stock actual: \").concat(selectedProduct.stock)});return;}}const newItem={productId:selectedProduct.id,name:selectedProduct.name,price:itemPrice,// Precio por unidad o por KG\nquantity:itemQuantity,// Cantidad de unidades o peso en gramos\nsubtotal:itemSubtotal,lots:selectedProduct.lots,unit:displayUnit// Unidad para mostrar en el ticket/carrito\n};setSaleItems([...saleItems,newItem]);setSelectedProduct(null);setSearchTerm('');setQuantity(1);setWeightInput(0);setSearchResults([]);setMessage({type:'',text:''});};const handleRemoveItem=index=>{const newItems=[...saleItems];newItems.splice(index,1);setSaleItems(newItems);};const calculateTotal=()=>saleItems.reduce((sum,item)=>sum+item.subtotal,0);const calculateSubtotal=()=>calculateTotal()/1.21;const calculateTax=()=>calculateTotal()-calculateSubtotal();const calculateChange=()=>{if(paymentMethod==='cash'){return cashReceived-calculateTotal();}return 0;};const handleSubmit=e=>{e.preventDefault();setMessage({type:'',text:''});if(saleItems.length===0){setMessage({type:'error',text:'No hay productos en el carrito.'});return;}if(paymentMethod==='cash'&&cashReceived<calculateTotal()){setMessage({type:'error',text:'El efectivo recibido es insuficiente.'});return;}if(paymentMethod==='current_account'&&!currentAccountCustomer){setMessage({type:'error',text:'Debe seleccionar un cliente para la cuenta corriente.'});return;}const total=calculateTotal();const subtotal=calculateSubtotal();const tax=calculateTax();const newSale={id:Date.now(),date:new Date().toISOString(),customerName:currentAccountCustomer?\"\".concat(currentAccountCustomer.name,\" \").concat(currentAccountCustomer.lastName):customerName,customerDNI:currentAccountCustomer?currentAccountCustomer.dni:null,paymentMethod,invoiceType,items:saleItems,total,tax,subtotal,marketId:getCurrentMarket()};try{onAddSale(newSale);if(paymentMethod==='current_account'){setMessage({type:'success',text:\"Venta agregada con \\xE9xito a la cuenta corriente de \".concat(currentAccountCustomer.name,\" \").concat(currentAccountCustomer.lastName,\".\")});}else{setMessage({type:'success',text:'Venta finalizada con éxito.'});}handlePrintTicket(newSale);setSaleItems([]);setSearchTerm('');setSelectedProduct(null);setQuantity(1);setWeightInput(0);setCustomerName('');setPaymentMethod('cash');setInvoiceType('ticket');setCashReceived(0);setCurrentAccountCustomer(null);}catch(error){setMessage({type:'error',text:\"No fue posible agregar la venta: \".concat(error.message||'Error desconocido')});}};const handleConsultPrice=()=>{if(selectedProduct){alert(\"El precio de \".concat(selectedProduct.name,\" es $\").concat(selectedProduct.price.toFixed(2),\".\"));}else{alert('Por favor, selecciona un producto para consultar su precio.');}};const handlePaymentMethodChange=e=>{const method=e.target.value;setPaymentMethod(method);setCashReceived(0);if(method==='current_account'){setShowCustomerSearchModal(true);}else{setCurrentAccountCustomer(null);}};const handleSelectCurrentAccountCustomer=customer=>{setCurrentAccountCustomer(customer);setShowCustomerSearchModal(false);};const handlePrintTicket=sale=>{const printWindow=window.open('','_blank');let ticketContent=\"\\n      <html>\\n      <head>\\n        <title>Ticket de Venta</title>\\n        <style>\\n          body { font-family: 'Courier New', monospace; font-size: 12px; width: 58mm; margin: 0 auto; padding: 5mm; }\\n          .header, .footer { text-align: center; margin-bottom: 5mm; }\\n          .items { width: 100%; border-collapse: collapse; margin-bottom: 5mm; }\\n          .items th, .items td { padding: 1mm 0; text-align: left; }\\n          .items th { border-bottom: 1px dashed #000; }\\n          .total { text-align: right; font-weight: bold; margin-top: 2mm; }\\n          .line { border-top: 1px dashed #000; margin: 2mm 0; }\\n        </style>\\n      </head>\\n      <body>\\n        <div class=\\\"header\\\">\\n          <h3>MINIMARKET PRO</h3>\\n          <p>Ticket de \".concat(sale.invoiceType==='ticket'?'Venta':\"Factura \".concat(sale.invoiceType),\"</p>\\n          <p>Fecha: \").concat(new Date(sale.date).toLocaleString(),\"</p>\\n          <p>Cliente: \").concat(sale.customerName||'Consumidor Final',\"</p>\\n          <div class=\\\"line\\\"></div>\\n        </div>\\n        \\n        <table class=\\\"items\\\">\\n          <thead>\\n            <tr>\\n              <th>Producto</th>\\n              <th>Cant.</th>\\n              <th>Precio</th>\\n              <th>Total</th>\\n            </tr>\\n          </thead>\\n          <tbody>\\n            \").concat(sale.items.map(item=>\"\\n              <tr>\\n                <td>\".concat(item.name,\"</td>\\n                <td>\").concat(item.quantity,\" \").concat(item.unit==='kg'?'kg':item.unit==='gr'?'gr':'',\"</td>\\n                <td>$\").concat(item.price.toFixed(2),\"</td>\\n                <td>$\").concat(item.subtotal.toFixed(2),\"</td>\\n              </tr>\\n            \")).join(''),\"\\n          </tbody>\\n        </table>\\n        <div class=\\\"line\\\"></div>\\n        <div class=\\\"total\\\">\\n          <p>Subtotal: $\").concat(sale.subtotal.toFixed(2),\"</p>\\n          <p>IVA (21%): $\").concat(sale.tax.toFixed(2),\"</p>\\n          <p>TOTAL: $\").concat(sale.total.toFixed(2),\"</p>\\n          <p>M\\xE9todo de Pago: \").concat(sale.paymentMethod,\"</p>\\n          \").concat(sale.paymentMethod==='cash'?\"<p>Efectivo Recibido: $\".concat(cashReceived.toFixed(2),\"</p><p>Cambio: $\").concat(calculateChange().toFixed(2),\"</p>\"):'',\"\\n        </div>\\n        <div class=\\\"line\\\"></div>\\n        <div class=\\\"footer\\\">\\n          <p>\\xA1Gracias por su compra!</p>\\n        </div>\\n      </body>\\n      </html>\\n    \");printWindow.document.write(ticketContent);printWindow.document.close();printWindow.print();};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-md dark:bg-gray-800\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4 text-gray-800 dark:text-white\",children:\"Nueva Venta\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[message.text&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 mb-4 rounded-md \".concat(message.type==='success'?'bg-green-100 text-green-800':'bg-red-100 text-red-800'),children:message.text}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Nombre del Cliente (Opcional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:currentAccountCustomer?\"\".concat(currentAccountCustomer.name,\" \").concat(currentAccountCustomer.lastName):customerName,onChange:e=>setCustomerName(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\",placeholder:\"Consumidor Final\",readOnly:!!currentAccountCustomer})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Tipo de Comprobante\"}),/*#__PURE__*/_jsxs(\"select\",{value:invoiceType,onChange:e=>setInvoiceType(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"ticket\",children:\"Ticket\"}),/*#__PURE__*/_jsx(\"option\",{value:\"A\",children:\"Factura A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"B\",children:\"Factura B\"}),/*#__PURE__*/_jsx(\"option\",{value:\"C\",children:\"Factura C\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-medium text-gray-700 dark:text-gray-200 mb-2\",children:\"Agregar Productos\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Escanear C\\xF3digo de Barras\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",ref:barcodeScannerRef,onKeyDown:handleBarcodeScan,placeholder:\"Escanear producto...\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"}),/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"O buscar por nombre\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>{setSearchTerm(e.target.value);setSelectedProduct(null);},placeholder:\"Buscar producto por nombre...\",className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"}),searchResults.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md max-h-60 overflow-auto dark:bg-gray-700\",children:searchResults.map(product=>/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-2 hover:bg-gray-100 cursor-pointer \".concat((selectedProduct===null||selectedProduct===void 0?void 0:selectedProduct.id)===product.id?'bg-blue-50':'',\" dark:hover:bg-gray-600 dark:text-gray-200\"),onClick:()=>{setSelectedProduct(product);setSearchTerm(product.name);setSearchResults([]);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[\"$\",product.price.toFixed(2),\" | Stock: \",product.stock,\" | \",product.barcode]})]},product.id))})]}),selectedProduct&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 items-end\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Producto seleccionado\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 bg-gray-50 rounded-md dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-800 dark:text-white\",children:selectedProduct.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[\"$\",selectedProduct.price.toFixed(2)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:[\"Stock: \",selectedProduct.stock]}),selectedProduct.lots&&selectedProduct.lots.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:[\"Vencimiento m\\xE1s pr\\xF3ximo: \",selectedProduct.lots[0].expiryDate]})]})]}),selectedProduct.unit==='gramos'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Peso (gramos)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",step:\"1\",value:weightInput,onChange:e=>setWeightInput(parseFloat(e.target.value)||0),ref:weightInputRef,className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-1\",children:[\"Precio estimado: $\",(selectedProduct.price/1000*weightInput).toFixed(2)]})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Cantidad\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",max:selectedProduct.stock,value:quantity,onChange:e=>setQuantity(Math.min(selectedProduct.stock,parseInt(e.target.value)||1)),className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-2\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleAddItem,className:\"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500\",children:\"Agregar al Carrito\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleConsultPrice,className:\"w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600\",children:\"Consultar Precio\"})]})]})]})]}),saleItems.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-medium text-gray-700 dark:text-gray-200 mb-2\",children:\"Productos en Carrito\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 p-4 rounded-md dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200 dark:divide-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\",children:\"Producto\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\",children:\"Precio Unit.\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\",children:\"Cantidad\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\",children:\"Subtotal\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\",children:\"Acci\\xF3n\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\",children:saleItems.map((item,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\",children:item.name}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\",children:[\"$\",item.price.toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\",children:[item.quantity,\" \",item.unit==='gramos'?'gr':'']}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\",children:[\"$\",item.subtotal.toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleRemoveItem(index),className:\"text-red-600 hover:text-red-900\",children:\"Eliminar\"})})]},index))}),/*#__PURE__*/_jsxs(\"tfoot\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{colSpan:\"3\",className:\"px-4 py-2 text-right text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Subtotal (sin IVA):\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\",children:[\"$\",calculateSubtotal().toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{colSpan:\"3\",className:\"px-4 py-2 text-right text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"IVA (21%):\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\",children:[\"$\",calculateTax().toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{colSpan:\"3\",className:\"px-4 py-2 text-right text-lg font-bold text-gray-800 dark:text-white\",children:\"Total:\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-lg font-bold text-gray-900 dark:text-white\",children:[\"$\",calculateTotal().toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{})]})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"M\\xE9todo de Pago\"}),/*#__PURE__*/_jsxs(\"select\",{value:paymentMethod,onChange:handlePaymentMethodChange,className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Efectivo\"}),/*#__PURE__*/_jsx(\"option\",{value:\"debit\",children:\"D\\xE9bito\"}),/*#__PURE__*/_jsx(\"option\",{value:\"credit\",children:\"Cr\\xE9dito\"}),/*#__PURE__*/_jsx(\"option\",{value:\"mp\",children:\"Mercado Pago\"}),/*#__PURE__*/_jsx(\"option\",{value:\"current_account\",children:\"Cuenta Corriente\"})]})]}),paymentMethod==='cash'&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Efectivo Recibido\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",step:\"0.01\",value:cashReceived,onChange:e=>setCashReceived(parseFloat(e.target.value)||0),className:\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold text-right mt-2 text-gray-800 dark:text-white\",children:[\"Cambio: $\",calculateChange().toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onCancel,className:\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-600\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:saleItems.length===0||paymentMethod==='cash'&&cashReceived<calculateTotal()||paymentMethod==='current_account'&&!currentAccountCustomer,className:\"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white \".concat(saleItems.length===0||paymentMethod==='cash'&&cashReceived<calculateTotal()||paymentMethod==='current_account'&&!currentAccountCustomer?'bg-gray-400':'bg-green-600 hover:bg-green-700',\" focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\"),children:\"Finalizar Venta\"})]})]}),showCustomerSearchModal&&/*#__PURE__*/_jsx(CustomerSearchModal,{customers:allCustomers,onSelectCustomer:handleSelectCurrentAccountCustomer,onClose:()=>{setShowCustomerSearchModal(false);setPaymentMethod('cash');}})]});};export default SaleForm;","map":{"version":3,"names":["React","useState","useEffect","useRef","getCurrentMarket","CustomerSearchModal","getAllData","jsx","_jsx","jsxs","_jsxs","SaleForm","_ref","products","onAddSale","onCancel","saleItems","setSaleItems","searchTerm","setSearchTerm","searchResults","setSearchResults","selectedProduct","setSelectedProduct","quantity","setQuantity","customerName","setCustomerName","paymentMethod","setPaymentMethod","invoiceType","setInvoiceType","cashReceived","setCashReceived","showCustomerSearchModal","setShowCustomerSearchModal","currentAccountCustomer","setCurrentAccountCustomer","allCustomers","setAllCustomers","message","setMessage","type","text","barcodeScannerRef","weightInput","setWeightInput","weightInputRef","loadCustomers","savedCustomers","marketId","customersForMarket","filter","c","length","results","product","name","toLowerCase","includes","barcode","stock","some","item","productId","id","handleBarcodeScan","e","key","scannedBarcode","target","value","foundProduct","find","p","current","unit","focus","concat","handleAddItem","itemQuantity","itemPrice","price","itemSubtotal","displayUnit","newItem","subtotal","lots","handleRemoveItem","index","newItems","splice","calculateTotal","reduce","sum","calculateSubtotal","calculateTax","calculateChange","handleSubmit","preventDefault","total","tax","newSale","Date","now","date","toISOString","lastName","customerDNI","dni","items","handlePrintTicket","error","handleConsultPrice","alert","toFixed","handlePaymentMethodChange","method","handleSelectCurrentAccountCustomer","customer","sale","printWindow","window","open","ticketContent","toLocaleString","map","join","document","write","close","print","className","children","onSubmit","onChange","placeholder","readOnly","ref","onKeyDown","onClick","expiryDate","min","step","parseFloat","max","Math","parseInt","colSpan","disabled","customers","onSelectCustomer","onClose"],"sources":["C:/Users/lucas/OneDrive/Documentos/Minimarket PRO/Version 1.0/src/components/SaleForm.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { getCurrentMarket } from '../utils/auth';\nimport CustomerSearchModal from './CustomerSearchModal';\nimport { getAllData } from '../utils/indexedDb';\n\nconst SaleForm = ({ products, onAddSale, onCancel }) => {\n  const [saleItems, setSaleItems] = useState([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [searchResults, setSearchResults] = useState([]);\n  const [selectedProduct, setSelectedProduct] = useState(null);\n  const [quantity, setQuantity] = useState(1); // Cantidad para productos por unidad\n  const [customerName, setCustomerName] = useState('');\n  const [paymentMethod, setPaymentMethod] = useState('cash');\n  const [invoiceType, setInvoiceType] = useState('ticket');\n  const [cashReceived, setCashReceived] = useState(0);\n\n  const [showCustomerSearchModal, setShowCustomerSearchModal] = useState(false);\n  const [currentAccountCustomer, setCurrentAccountCustomer] = useState(null);\n  const [allCustomers, setAllCustomers] = useState([]);\n  const [message, setMessage] = useState({ type: '', text: '' });\n\n  const barcodeScannerRef = useRef(null);\n  const [weightInput, setWeightInput] = useState(0); // Peso en kilogramos (ej. 0.250)\n  const weightInputRef = useRef(null);\n\n  useEffect(() => {\n    const loadCustomers = async () => {\n      const savedCustomers = await getAllData('customers');\n      const marketId = getCurrentMarket();\n      const customersForMarket = savedCustomers.filter(c => c.marketId === marketId);\n      setAllCustomers(customersForMarket);\n    };\n    loadCustomers();\n  }, []);\n\n  useEffect(() => {\n    if (searchTerm.length > 1) {\n      const results = products.filter(\n        product => \n          (product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n          (product.barcode && product.barcode.includes(searchTerm))) &&\n          product.stock > 0 &&\n          !saleItems.some(item => item.productId === product.id)\n      );\n      setSearchResults(results);\n    } else {\n      setSearchResults([]);\n    }\n  }, [searchTerm, products, saleItems]);\n\n  const handleBarcodeScan = (e) => {\n    if (e.key === 'Enter') {\n      const scannedBarcode = e.target.value;\n      const foundProduct = products.find(p => p.barcode === scannedBarcode);\n      if (foundProduct) {\n        setSelectedProduct(foundProduct);\n        setSearchTerm(foundProduct.name);\n        setQuantity(1);\n        setWeightInput(0);\n        setSearchResults([]);\n        barcodeScannerRef.current.value = '';\n        if (foundProduct.unit === 'gramos' && weightInputRef.current) {\n          weightInputRef.current.focus();\n        }\n      } else {\n        setMessage({ type: 'error', text: `Producto con código ${scannedBarcode} no encontrado.` });\n      }\n    }\n  };\n\n  const handleAddItem = () => {\n    if (!selectedProduct) {\n      setMessage({ type: 'error', text: 'Debe seleccionar un producto.' });\n      return;\n    }\n\n    let itemQuantity = quantity;\n    let itemPrice = selectedProduct.price; // Precio por unidad o por KG\n    let itemSubtotal = selectedProduct.price * quantity;\n    let displayUnit = selectedProduct.unit;\n\n    if (selectedProduct.unit === 'gramos') {\n      if (weightInput <= 0) {\n        setMessage({ type: 'error', text: 'Debe ingresar un peso válido para productos por gramo.' });\n        return;\n      }\n      itemQuantity = weightInput; // La cantidad es el peso en gramos\n      itemPrice = selectedProduct.price; // Precio por KG\n      itemSubtotal = (selectedProduct.price / 1000) * weightInput; // Subtotal basado en peso\n      displayUnit = 'kg'; // Mostrar en kg en el carrito\n    } else {\n      if (quantity <= 0) {\n        setMessage({ type: 'error', text: 'Debe ingresar una cantidad válida.' });\n        return;\n      }\n      if (quantity > selectedProduct.stock) {\n        setMessage({ type: 'error', text: `No hay suficiente stock para ${selectedProduct.name}. Stock actual: ${selectedProduct.stock}` });\n        return;\n      }\n    }\n\n    const newItem = {\n      productId: selectedProduct.id,\n      name: selectedProduct.name,\n      price: itemPrice, // Precio por unidad o por KG\n      quantity: itemQuantity, // Cantidad de unidades o peso en gramos\n      subtotal: itemSubtotal,\n      lots: selectedProduct.lots,\n      unit: displayUnit // Unidad para mostrar en el ticket/carrito\n    };\n\n    setSaleItems([...saleItems, newItem]);\n    setSelectedProduct(null);\n    setSearchTerm('');\n    setQuantity(1);\n    setWeightInput(0);\n    setSearchResults([]);\n    setMessage({ type: '', text: '' });\n  };\n\n  const handleRemoveItem = (index) => {\n    const newItems = [...saleItems];\n    newItems.splice(index, 1);\n    setSaleItems(newItems);\n  };\n\n  const calculateTotal = () => saleItems.reduce((sum, item) => sum + item.subtotal, 0);\n  const calculateSubtotal = () => calculateTotal() / 1.21;\n  const calculateTax = () => calculateTotal() - calculateSubtotal();\n  const calculateChange = () => {\n    if (paymentMethod === 'cash') {\n      return cashReceived - calculateTotal();\n    }\n    return 0;\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    setMessage({ type: '', text: '' });\n\n    if (saleItems.length === 0) {\n      setMessage({ type: 'error', text: 'No hay productos en el carrito.' });\n      return;\n    }\n    if (paymentMethod === 'cash' && cashReceived < calculateTotal()) {\n      setMessage({ type: 'error', text: 'El efectivo recibido es insuficiente.' });\n      return;\n    }\n    if (paymentMethod === 'current_account' && !currentAccountCustomer) {\n      setMessage({ type: 'error', text: 'Debe seleccionar un cliente para la cuenta corriente.' });\n      return;\n    }\n\n    const total = calculateTotal();\n    const subtotal = calculateSubtotal();\n    const tax = calculateTax();\n\n    const newSale = {\n      id: Date.now(),\n      date: new Date().toISOString(),\n      customerName: currentAccountCustomer ? `${currentAccountCustomer.name} ${currentAccountCustomer.lastName}` : customerName,\n      customerDNI: currentAccountCustomer ? currentAccountCustomer.dni : null,\n      paymentMethod,\n      invoiceType,\n      items: saleItems,\n      total,\n      tax,\n      subtotal,\n      marketId: getCurrentMarket()\n    };\n\n    try {\n      onAddSale(newSale);\n      if (paymentMethod === 'current_account') {\n        setMessage({ type: 'success', text: `Venta agregada con éxito a la cuenta corriente de ${currentAccountCustomer.name} ${currentAccountCustomer.lastName}.` });\n      } else {\n        setMessage({ type: 'success', text: 'Venta finalizada con éxito.' });\n      }\n      handlePrintTicket(newSale);\n      setSaleItems([]);\n      setSearchTerm('');\n      setSelectedProduct(null);\n      setQuantity(1);\n      setWeightInput(0);\n      setCustomerName('');\n      setPaymentMethod('cash');\n      setInvoiceType('ticket');\n      setCashReceived(0);\n      setCurrentAccountCustomer(null);\n    } catch (error) {\n      setMessage({ type: 'error', text: `No fue posible agregar la venta: ${error.message || 'Error desconocido'}` });\n    }\n  };\n\n  const handleConsultPrice = () => {\n    if (selectedProduct) {\n      alert(`El precio de ${selectedProduct.name} es $${selectedProduct.price.toFixed(2)}.`);\n    } else {\n      alert('Por favor, selecciona un producto para consultar su precio.');\n    }\n  };\n\n  const handlePaymentMethodChange = (e) => {\n    const method = e.target.value;\n    setPaymentMethod(method);\n    setCashReceived(0);\n    if (method === 'current_account') {\n      setShowCustomerSearchModal(true);\n    } else {\n      setCurrentAccountCustomer(null);\n    }\n  };\n\n  const handleSelectCurrentAccountCustomer = (customer) => {\n    setCurrentAccountCustomer(customer);\n    setShowCustomerSearchModal(false);\n  };\n\n  const handlePrintTicket = (sale) => {\n    const printWindow = window.open('', '_blank');\n    let ticketContent = `\n      <html>\n      <head>\n        <title>Ticket de Venta</title>\n        <style>\n          body { font-family: 'Courier New', monospace; font-size: 12px; width: 58mm; margin: 0 auto; padding: 5mm; }\n          .header, .footer { text-align: center; margin-bottom: 5mm; }\n          .items { width: 100%; border-collapse: collapse; margin-bottom: 5mm; }\n          .items th, .items td { padding: 1mm 0; text-align: left; }\n          .items th { border-bottom: 1px dashed #000; }\n          .total { text-align: right; font-weight: bold; margin-top: 2mm; }\n          .line { border-top: 1px dashed #000; margin: 2mm 0; }\n        </style>\n      </head>\n      <body>\n        <div class=\"header\">\n          <h3>MINIMARKET PRO</h3>\n          <p>Ticket de ${sale.invoiceType === 'ticket' ? 'Venta' : `Factura ${sale.invoiceType}`}</p>\n          <p>Fecha: ${new Date(sale.date).toLocaleString()}</p>\n          <p>Cliente: ${sale.customerName || 'Consumidor Final'}</p>\n          <div class=\"line\"></div>\n        </div>\n        \n        <table class=\"items\">\n          <thead>\n            <tr>\n              <th>Producto</th>\n              <th>Cant.</th>\n              <th>Precio</th>\n              <th>Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${sale.items.map(item => `\n              <tr>\n                <td>${item.name}</td>\n                <td>${item.quantity} ${item.unit === 'kg' ? 'kg' : (item.unit === 'gr' ? 'gr' : '')}</td>\n                <td>$${item.price.toFixed(2)}</td>\n                <td>$${item.subtotal.toFixed(2)}</td>\n              </tr>\n            `).join('')}\n          </tbody>\n        </table>\n        <div class=\"line\"></div>\n        <div class=\"total\">\n          <p>Subtotal: $${sale.subtotal.toFixed(2)}</p>\n          <p>IVA (21%): $${sale.tax.toFixed(2)}</p>\n          <p>TOTAL: $${sale.total.toFixed(2)}</p>\n          <p>Método de Pago: ${sale.paymentMethod}</p>\n          ${sale.paymentMethod === 'cash' ? `<p>Efectivo Recibido: $${cashReceived.toFixed(2)}</p><p>Cambio: $${calculateChange().toFixed(2)}</p>` : ''}\n        </div>\n        <div class=\"line\"></div>\n        <div class=\"footer\">\n          <p>¡Gracias por su compra!</p>\n        </div>\n      </body>\n      </html>\n    `;\n    printWindow.document.write(ticketContent);\n    printWindow.document.close();\n    printWindow.print();\n  };\n\n  return (\n    <div className=\"bg-white p-6 rounded-lg shadow-md dark:bg-gray-800\">\n      <h3 className=\"text-lg font-semibold mb-4 text-gray-800 dark:text-white\">Nueva Venta</h3>\n      <form onSubmit={handleSubmit}>\n        {message.text && (\n          <div className={`p-3 mb-4 rounded-md ${message.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n            {message.text}\n          </div>\n        )}\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Nombre del Cliente (Opcional)</label>\n            <input\n              type=\"text\"\n              value={currentAccountCustomer ? `${currentAccountCustomer.name} ${currentAccountCustomer.lastName}` : customerName}\n              onChange={(e) => setCustomerName(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n              placeholder=\"Consumidor Final\"\n              readOnly={!!currentAccountCustomer}\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Tipo de Comprobante</label>\n            <select\n              value={invoiceType}\n              onChange={(e) => setInvoiceType(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            >\n              <option value=\"ticket\">Ticket</option>\n              <option value=\"A\">Factura A</option>\n              <option value=\"B\">Factura B</option>\n              <option value=\"C\">Factura C</option>\n            </select>\n          </div>\n        </div>\n\n        <div className=\"mb-6\">\n          <h4 className=\"text-md font-medium text-gray-700 dark:text-gray-200 mb-2\">Agregar Productos</h4>\n          <div className=\"space-y-4\">\n            <div className=\"relative\">\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Escanear Código de Barras</label>\n              <input\n                type=\"text\"\n                ref={barcodeScannerRef}\n                onKeyDown={handleBarcodeScan}\n                placeholder=\"Escanear producto...\"\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 mb-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n              />\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">O buscar por nombre</label>\n              <input\n                type=\"text\"\n                value={searchTerm}\n                onChange={(e) => {\n                  setSearchTerm(e.target.value);\n                  setSelectedProduct(null);\n                }}\n                placeholder=\"Buscar producto por nombre...\"\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n              />\n              {searchResults.length > 0 && (\n                <div className=\"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md max-h-60 overflow-auto dark:bg-gray-700\">\n                  {searchResults.map(product => (\n                    <div\n                      key={product.id}\n                      className={`px-4 py-2 hover:bg-gray-100 cursor-pointer ${selectedProduct?.id === product.id ? 'bg-blue-50' : ''} dark:hover:bg-gray-600 dark:text-gray-200`}\n                      onClick={() => {\n                        setSelectedProduct(product);\n                        setSearchTerm(product.name);\n                        setSearchResults([]);\n                      }}\n                    >\n                      <div className=\"font-medium\">{product.name}</div>\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        ${product.price.toFixed(2)} | Stock: {product.stock} | {product.barcode}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {selectedProduct && (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 items-end\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Producto seleccionado</label>\n                  <div className=\"p-2 bg-gray-50 rounded-md dark:bg-gray-700\">\n                    <div className=\"font-medium text-gray-800 dark:text-white\">{selectedProduct.name}</div>\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">${selectedProduct.price.toFixed(2)}</div>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">Stock: {selectedProduct.stock}</div>\n                    {selectedProduct.lots && selectedProduct.lots.length > 0 && (\n                      <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                        Vencimiento más próximo: {selectedProduct.lots[0].expiryDate}\n                      </div>\n                    )}\n                  </div>\n                </div>\n                {selectedProduct.unit === 'gramos' ? (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Peso (gramos)</label>\n                    <input\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"1\"\n                      value={weightInput}\n                      onChange={(e) => setWeightInput(parseFloat(e.target.value) || 0)}\n                      ref={weightInputRef}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                    />\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                      Precio estimado: ${((selectedProduct.price / 1000) * weightInput).toFixed(2)}\n                    </p>\n                  </div>\n                ) : (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Cantidad</label>\n                    <input\n                      type=\"number\"\n                      min=\"1\"\n                      max={selectedProduct.stock}\n                      value={quantity}\n                      onChange={(e) => setQuantity(Math.min(selectedProduct.stock, parseInt(e.target.value) || 1))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                    />\n                  </div>\n                )}\n                <div className=\"flex flex-col space-y-2\">\n                  <button\n                    type=\"button\"\n                    onClick={handleAddItem}\n                    className=\"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  >\n                    Agregar al Carrito\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={handleConsultPrice}\n                    className=\"w-full px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600\"\n                  >\n                    Consultar Precio\n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {saleItems.length > 0 && (\n          <div className=\"mb-6\">\n            <h4 className=\"text-md font-medium text-gray-700 dark:text-gray-200 mb-2\">Productos en Carrito</h4>\n            <div className=\"bg-gray-50 p-4 rounded-md dark:bg-gray-700\">\n              <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-600\">\n                <thead>\n                  <tr>\n                    <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">Producto</th>\n                    <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">Precio Unit.</th>\n                    <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">Cantidad</th>\n                    <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">Subtotal</th>\n                    <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300\">Acción</th>\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n                  {saleItems.map((item, index) => (\n                    <tr key={index}>\n                      <td className=\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\">{item.name}</td>\n                      <td className=\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\">${item.price.toFixed(2)}</td>\n                      <td className=\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\">{item.quantity} {item.unit === 'gramos' ? 'gr' : ''}</td>\n                      <td className=\"px-4 py-2 whitespace-nowrap text-sm text-gray-900 dark:text-white\">${item.subtotal.toFixed(2)}</td>\n                      <td className=\"px-4 py-2 whitespace-nowrap text-sm font-medium\">\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveItem(index)}\n                          className=\"text-red-600 hover:text-red-900\"\n                        >\n                          Eliminar\n                        </button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"3\" className=\"px-4 py-2 text-right text-sm font-medium text-gray-700 dark:text-gray-300\">Subtotal (sin IVA):</td>\n                    <td className=\"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\n                      ${calculateSubtotal().toFixed(2)}\n                    </td>\n                    <td></td>\n                  </tr>\n                  <tr>\n                    <td colSpan=\"3\" className=\"px-4 py-2 text-right text-sm font-medium text-gray-700 dark:text-gray-300\">IVA (21%):</td>\n                    <td className=\"px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\n                      ${calculateTax().toFixed(2)}\n                    </td>\n                    <td></td>\n                  </tr>\n                  <tr>\n                    <td colSpan=\"3\" className=\"px-4 py-2 text-right text-lg font-bold text-gray-800 dark:text-white\">Total:</td>\n                    <td className=\"px-4 py-2 whitespace-nowrap text-lg font-bold text-gray-900 dark:text-white\">\n                      ${calculateTotal().toFixed(2)}\n                    </td>\n                    <td></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Método de Pago</label>\n          <select\n            value={paymentMethod}\n            onChange={handlePaymentMethodChange}\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n          >\n            <option value=\"cash\">Efectivo</option>\n            <option value=\"debit\">Débito</option>\n            <option value=\"credit\">Crédito</option>\n            <option value=\"mp\">Mercado Pago</option>\n            <option value=\"current_account\">Cuenta Corriente</option>\n          </select>\n        </div>\n\n        {paymentMethod === 'cash' && (\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Efectivo Recibido</label>\n            <input\n              type=\"number\"\n              min=\"0\"\n              step=\"0.01\"\n              value={cashReceived}\n              onChange={(e) => setCashReceived(parseFloat(e.target.value) || 0)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n            />\n            <p className=\"text-lg font-bold text-right mt-2 text-gray-800 dark:text-white\">Cambio: ${calculateChange().toFixed(2)}</p>\n          </div>\n        )}\n\n        <div className=\"mt-6 flex justify-end space-x-3\">\n          <button\n            type=\"button\"\n            onClick={onCancel}\n            className=\"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-600\"\n          >\n            Cancelar\n          </button>\n          <button\n            type=\"submit\"\n            disabled={saleItems.length === 0 || (paymentMethod === 'cash' && cashReceived < calculateTotal()) || (paymentMethod === 'current_account' && !currentAccountCustomer)}\n            className={`px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${saleItems.length === 0 || (paymentMethod === 'cash' && cashReceived < calculateTotal()) || (paymentMethod === 'current_account' && !currentAccountCustomer) ? 'bg-gray-400' : 'bg-green-600 hover:bg-green-700'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500`}\n          >\n            Finalizar Venta\n          </button>\n        </div>\n      </form>\n\n      {showCustomerSearchModal && (\n        <CustomerSearchModal\n          customers={allCustomers}\n          onSelectCustomer={handleSelectCurrentAccountCustomer}\n          onClose={() => {\n            setShowCustomerSearchModal(false);\n            setPaymentMethod('cash');\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default SaleForm;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}